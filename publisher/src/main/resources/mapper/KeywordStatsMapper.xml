<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--suppress SqlResolve -->
<mapper namespace="issac.mapper.KeywordStatsMapper">
    <select id="selectKeywordStats" resultType="issac.bean.KeywordStats">
        select keyword,
               sum(keyword_stats.ct * multiIf(source = 'SEARCH', 10, source = 'ORDER', 3, source = 'CART', 2, source = 'CLICK', 1, 0)) ct
        from keyword_stats
        where toYYYYMMDD(stt) = #{date}
        group by keyword
        order by sum(keyword_stats.ct) desc
        limit #{limit}
    </select>
</mapper>